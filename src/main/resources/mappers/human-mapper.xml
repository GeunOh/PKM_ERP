<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="humanMapper">
	
	<resultMap type="Human" id="humanResult">
		<id column="ENO" property="eno"/>
		<result column="PWD" property="pwd"/>
		<result column="ENAME" property="name"/>
		<result column="EBIRTHDAY" property="birthday"/>
		<result column="EADDRESS" property="address"/>
		<result column="EEMAIL" property="email"/>
		<result column="EPHONE" property="phone"/>
		<result column="INDATE" property="indate"/>
		<result column="OUTDATE" property="outdate"/>
		<result column="OUTYN" property="outyn"/>
		<result column="RCODE" property="rcode"/>
		<result column="DCODE" property="dcode"/>
		<result column="ORIGINALNAME_FILE" property="originalFileName"/>
		<result column="RENAME_FILE" property="renameFileName"/>
	</resultMap>
	
	<resultMap type="Department" id="deptResult">
		<id column="DCODE" property="dcode"/>
		<result column="DNAME" property="dname"/>
		<result column="DCOMMENT" property="dcomment"/>
		<result column="DBOSS" property="dboss"/>
		<result column="STARTDATE" property="startDate"/>
	</resultMap>
	
	<resultMap type="Rank" id="rankResult">
		<id column="RCODE" property="rcode"/>
		<result column="RNAME" property="rname"/>
	</resultMap>
	
	<resultMap type="Vacation" id="vacationResult">
		<id column="VNO" property="vno" />
		<result column="ENO" property="eno"/>
		<result column="VTYPE" property="vType"/>
		<result column="STARTDATE" property="startDate"/>
		<result column="ENDDATE" property="endDate"/>
		<result column="REASON" property="reason"/>
		<result column="REQUESTDATE" property="requestDate"/>
		<result column="STATUS" property="status"/>
		<result column="USEDAY" property="useDay"/>
		<result column="DNAME" property="dname"/>
		<result column="RNAME" property="rname"/>
	</resultMap>

	<select id="HumanListCount" resultType="_int">
		SELECT COUNT(*) FROM TB_USER
	</select>
	
	<select id="HumanList" resultMap="humanResult">
		SELECT ENO, PWD, ENAME, EBIRTHDAY, EADDRESS, EEMAIL, EPHONE, INDATE, OUTDATE, OUTYN, RNAME RCODE, DNAME DCODE FROM HUMANLIST
	</select>
	
	<!-- 부서 목록 조회 -->
	<select id="selectDepartmentList" resultMap="deptResult">
		SELECT * FROM TB_DEPT
	</select>
	
	<!-- 부서 조회 -->
	<select id="selectDepartment" resultType="Department">
		SELECT * FROM ONEDEPT
		<where>
			DNAME=#{DEPTNAME}
		</where>
	</select>
	
	<select id="SearchHumanListCount" resultType="_int">
		SELECT COUNT(*) FROM HUMANLIST
		<where>
			<if test="so.all != null"></if>
			<if test="so.inUser != null">AND OUTYN = 'N'</if>
			<if test="so.outUser != null">AND OUTYN = 'Y'</if>
			<if test="so.dateAll != null"></if>
			<if test="so.dateSelect != null">AND INDATE BETWEEN #{date} AND #{date2} </if>
			<if test="dept != null and dept != ''">AND DCODE = #{dept}</if>
			<if test="rank != null and rank != ''">AND RCODE = #{rank}</if>
			<if test="email != null and email != ''">AND EEMAIL = #{email}</if>
			<if test="eno != null and eno != ''">AND  ENO = #{eno}</if>
			<if test="name != null and name != ''">AND  ENAME = #{name}</if>
		</where>
	</select>
	
	<select id="SearchHumanList" resultMap="humanResult">
		SELECT ENO, PWD, ENAME, EBIRTHDAY, EADDRESS, EEMAIL, EPHONE, INDATE, OUTDATE, OUTYN, RNAME RCODE, DNAME DCODE FROM HUMANLIST
		<where>
			<if test="so.all != null"></if>
			<if test="so.inUser != null">AND OUTYN = 'N'</if>
			<if test="so.outUser != null">AND OUTYN = 'Y'</if>
			<if test="so.dateAll != null"></if>
			<if test="so.dateSelect != null ">AND INDATE BETWEEN #{date} AND #{date2} </if>
			<if test="dept != null and dept != ''">AND DCODE = #{dept}</if>
			<if test="rank != null and rank != ''">AND RCODE = #{rank}</if>
			<if test="email != null and email != ''">AND EEMAIL = #{email}</if>
			<if test="eno != null and eno != ''">AND  ENO = #{eno}</if>
			<if test="name != null and name != ''">AND  ENAME = #{name}</if>
		</where>
	</select>
	
	<select id="selectPositionCount" resultType="_int">
		SELECT COUNT(*) FROM TB_USER WHERE OUTYN = 'N'
		<if test="name != null or name != ''">AND ename=#{name}</if>
	</select>
	
	<!-- 직급 검색 -->
	<select id="searchPosition" resultMap="rankResult">
		SELECT * FROM TB_RANK
		<where>
			<if test="rcode != null and rcode != ''">AND rcode=#{rcode}</if>
			<if test="rname != null and rname != ''">AND rname=#{rname}</if>
		</where>
	</select>
	
	<select id="postionListCount" resultType="_int">
		SELECT COUNT(*) FROM TB_USER WHERE OUTYN = 'N'
	</select>
	
	<!-- 직급 목록 -->
	<select id="positionList" resultMap="rankResult">
		SELECT * FROM TB_RANK
	</select>
	
	<!-- 직급 등록 -->
	<insert id="addPosition">
		INSERT INTO TB_RANK VALUES(#{rcode},#{rname})
	</insert>
	
	<!-- 직급 선택 시 사원목록 조회(재직중인 사원만) -->
	<select id="choiceRcode" resultMap="humanResult">
		SELECT R.RCODE, RNAME DCODE, ENO, ENAME 
		FROM TB_USER U, TB_RANK R
		WHERE U.RCODE = R.RCODE
		AND OUTYN = 'N'
		AND R.RCODE=#{rcode}
	</select>
	
	<delete id="deletePosition">
		DELETE FROM TB_RANK WHERE RCODE IN
		<foreach collection="array" open="(" close=")" separator="," item="rcode">
			#{rcode}
		</foreach>
	</delete>
	
	<!-- 부서 등록 -->
	<insert id="addDept" parameterType="Department">
		INSERT INTO tb_dept values(#{dcode}, #{dname}, #{dcomment}, (SELECT eno FROM tb_user WHERE ename=#{eno}), SYSDATE)
	</insert>
	
	<!-- 부서 삭제 -->
	<delete id="delDept">
		DELETE FROM TB_DEPT WHERE DNAME IN
		<foreach collection="array" open="(" close=")" separator="," item="dname">
			#{dname}
		</foreach>
	</delete>
	
	<!-- 부서 수정 -->
	<update id="modifyDept">
		UPDATE TB_DEPT 
		SET DCODE=#{dcode}, DCOMMENT=#{dcomment}, DNAME=#{dname}, STARTDATE=#{startDate}, 
			ENO=(SELECT ENO FROM tb_user WHERE ENAME=#{eno}) 
		WHERE DNAME=#{beforeDeptName}
	</update>
	
	<insert id="humanInsert">
		INSERT INTO TB_USER VALUES(#{h.eno},#{h.pwd},#{h.name},#{birthDay},#{h.address},#{h.email},#{h.phone},#{h.gender},#{inDate},null,'N',#{h.rcode},#{h.dcode},#{h.originalFileName},#{h.renameFileName})	
	</insert>	
	
	<select id="enoDupChk" resultType="_int">
		SELECT COUNT(*) FROM TB_USER WHERE ENO = #{eno}
	</select>
	
	<select id="humanAddDeptList" resultMap="deptResult">
	 	SELECT DCODE, DNAME FROM TB_DEPT
	</select>
	
	<select id="humanAddRankList" resultMap="rankResult">
	 	SELECT * FROM TB_RANK
	</select>
	
	<select id="Login" resultMap="humanResult">
		SELECT * FROM SOLOUSER WHERE ENO = #{id} AND OUTYN = 'N'
	</select>
	
	<!-- 부서 중복되는지 조회  -->
	<select id="dcodeDupChk" resultType="_int">
		SELECT COUNT(*) FROM TB_DEPT WHERE dcode = #{dcode}
	</select>
	
	<!-- 휴가 신청 목록 조회  -->
	<select id="vacationList" resultMap="vacationResult">
		SELECT VNO, ENAME ENO, VTYPE, STARTDATE, ENDDATE, USEDAY,
			   REASON, REQUESTDATE, STATUS, DNAME, RNAME 
		FROM VACATIONLIST
	</select>
	
	<!-- 휴가 신청 승인 -->
	<update id="approvalVacation">
		UPDATE TB_VACATION SET STATUS='Y' WHERE VNO IN
		<foreach collection="array" item="vno" open="(" close=")" separator=",">
			#{vno}
		</foreach>
	</update>
	
	<!-- 휴가 신청 거절 -->
	<update id="refuseVacation">
		UPDATE TB_VACATION SET STATUS='F' WHERE VNO IN
		<foreach collection="array" item="vno" open="(" close=")" separator=",">
			#{vno}
		</foreach>
	</update>
	
	<!-- 휴가 신청 목록 검색 -->
	<select id="searchVacationList" resultMap="vacationResult">
		SELECT VNO, ENAME ENO, VTYPE, STARTDATE, ENDDATE, USEDAY,
			   REASON, REQUESTDATE, STATUS, DNAME, RNAME 
		FROM VACATIONLIST
		<where>
			<if test="so.dateAll != null"></if>
			<if test="so.dateSelect != null">AND REQUESTDATE BETWEEN #{date} AND #{date2}</if>
			<if test="selectDept != ''">AND DCODE=#{selectDept}</if>
			<if test="selectRank != ''">AND RCODE=#{selectRank}</if>
			<if test="eno != ''">AND ENO=#{eno}</if>
			<if test="name != ''">AND ENAME=#{name}</if>
		</where>
	</select>
	
	<!-- 휴가 신청 목록 전체 행 개수  -->
	<select id="vacationListCount" resultType="_int">
		SELECT COUNT(*) FROM TB_VACATION
	</select>
	
	<!-- 휴가 신청 목록 검색 결과 행 개수  -->
	<select id="searchVacationListCount" resultType="_int">
		SELECT COUNT(*) FROM VACATIONLIST
		<where>
			<if test="so.dateAll != null"></if>
			<if test="so.dateSelect != null">AND REQUESTDATE BETWEEN #{date} AND #{date2}</if>
			<if test="selectDept != ''">AND DCODE=#{selectDept}</if>
			<if test="selectRank != ''">AND RCODE=#{selectRank}</if>
			<if test="eno != ''">AND ENO=#{eno}</if>
			<if test="name != ''">AND ENAME=#{name}</if>
		</where>
	</select>
	
	<insert id="addVacation" parameterType="Vacation">
		INSERT INTO TB_VACATION_RECORD VALUES
		(TB_VACATION_VNO.nextval, #{eno}, #{vType}, #{startDate}, #{endDate}, #{useDay}, 
		<if test="reason != ''">#{reason}, SYSDATE, DEFAULT)</if>
		<if test="reason == ''">NULL, SYSDATE, DEFAULT)</if>
	</insert>
	
</mapper>
